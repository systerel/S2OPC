# Licensed to Systerel under one or more contributor license
# agreements. See the NOTICE file distributed with this work
# for additional information regarding copyright ownership.
# Systerel licenses this file to you under the Apache
# License, Version 2.0 (the "License"); you may not use this
# file except in compliance with the License. You may obtain
# a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

ifeq ($(S2OPC_PRJ_DIR),)
$(error S2OPC_PRJ_DIR and should be set to S2OPC project path)
else

# S2OPC client server paths
S2OPC_SRC_DIR = ${S2OPC_PRJ_DIR}/src
S2OPC_CLIENTSERVER_DIR = ${S2OPC_SRC_DIR}/ClientServer
S2OPC_CLIENTSERVER_ADDRESSSPACE_DIR = ${S2OPC_CLIENTSERVER_DIR}/address_space
S2OPC_CLIENTSERVER_APITOOLKIT_DIR = ${S2OPC_CLIENTSERVER_DIR}/api_toolkit
S2OPC_CLIENTSERVER_CONFIGURATION_DIR = ${S2OPC_CLIENTSERVER_DIR}/configuration
S2OPC_CLIENTSERVER_FRONTEND_DIR = ${S2OPC_CLIENTSERVER_DIR}/frontend
S2OPC_FRONTEND_CLIENTWRAPPER_DIR = ${S2OPC_CLIENTSERVER_FRONTEND_DIR}/client_wrapper
S2OPC_CLIENTWRAPPER_DEPRECATED_DIR = ${S2OPC_FRONTEND_CLIENTWRAPPER_DIR}/deprecated
S2OPC_CLIENTWRAPPER_INTERNAL_DIR = ${S2OPC_FRONTEND_CLIENTWRAPPER_DIR}/internal
S2OPC_FRONTEND_COMMONWRAPPER_DIR = ${S2OPC_CLIENTSERVER_FRONTEND_DIR}/common_wrapper
S2OPC_FRONTEND_HELPERWRAPPER_DIR = ${S2OPC_CLIENTSERVER_FRONTEND_DIR}/helper_wrapper
S2OPC_FRONTEND_SERVERWRAPPER_DIR = ${S2OPC_CLIENTSERVER_FRONTEND_DIR}/server_wrapper
S2OPC_SERVERWRAPPER_INTERNAL_DIR = ${S2OPC_FRONTEND_SERVERWRAPPER_DIR}/internal
S2OPC_CLIENTSERVER_LOADERS_DIR = ${S2OPC_CLIENTSERVER_DIR}/loaders
S2OPC_LOADERS_ADDRESSSPACELOADERS_DIR = ${S2OPC_CLIENTSERVER_LOADERS_DIR}/address_space_loaders
S2OPC_ADDRESSSPACELOADERS_EMBEDDED_DIR = ${S2OPC_LOADERS_ADDRESSSPACELOADERS_DIR}/embedded
S2OPC_CLIENTSERVER_SECURECHANNELS_DIR = ${S2OPC_CLIENTSERVER_DIR}/secure_channels
S2OPC_CLIENTSERVER_SERVICES_DIR = ${S2OPC_CLIENTSERVER_DIR}/services
S2OPC_SERVICES_B2C_DIR = ${S2OPC_CLIENTSERVER_SERVICES_DIR}/b2c
S2OPC_SERVICES_BGENC_DIR = ${S2OPC_CLIENTSERVER_SERVICES_DIR}/bgenc
S2OPC_CLIENTSERVER_SOCKETS_DIR = ${S2OPC_CLIENTSERVER_DIR}/sockets

$(S2OPC_CLIENTSERVER_CONFIGURATION_DIR)/sopc_toolkit_build_info.c: $(S2OPC_CLIENTSERVER_CONFIGURATION_DIR)/sopc_toolkit_build_info.c_
	cp $(S2OPC_CLIENTSERVER_CONFIGURATION_DIR)/sopc_toolkit_build_info.c_ $(S2OPC_CLIENTSERVER_CONFIGURATION_DIR)/sopc_toolkit_build_info.c

remove_build_info_clientserver:
	rm -f $(S2OPC_CLIENTSERVER_CONFIGURATION_DIR)/sopc_toolkit_build_info.c

# Add client server S2OPC inclusion path
CPPFLAGS += -I${S2OPC_CLIENTSERVER_ADDRESSSPACE_DIR} -I${S2OPC_CLIENTSERVER_APITOOLKIT_DIR} \
			-I${S2OPC_CLIENTSERVER_CONFIGURATION_DIR} -I${S2OPC_FRONTEND_CLIENTWRAPPER_DIR} \
			-I${S2OPC_CLIENTWRAPPER_DEPRECATED_DIR} -I${S2OPC_CLIENTWRAPPER_INTERNAL_DIR} \
			-I${S2OPC_FRONTEND_COMMONWRAPPER_DIR} -I${S2OPC_FRONTEND_HELPERWRAPPER_DIR} \
			-I${S2OPC_FRONTEND_SERVERWRAPPER_DIR} -I${S2OPC_SERVERWRAPPER_INTERNAL_DIR} \
			-I${S2OPC_CLIENTSERVER_LOADERS_DIR} -I${S2OPC_LOADERS_ADDRESSSPACELOADERS_DIR} \
			-I${S2OPC_CLIENTSERVER_SECURECHANNELS_DIR} -I${S2OPC_CLIENTSERVER_SERVICES_DIR} \
			-I${S2OPC_SERVICES_B2C_DIR} -I${S2OPC_SERVICES_BGENC_DIR} -I${S2OPC_CLIENTSERVER_SOCKETS_DIR}


# Client Server C source files

S2OPC_ADDRESSSPACE_OBJ := $(patsubst %.c,%,$(wildcard ${S2OPC_CLIENTSERVER_ADDRESSSPACE_DIR}/*.c))

S2OPC_CLIENTSERVER_APITOOLKIT_OBJ := $(patsubst %.c,%,$(wildcard ${S2OPC_CLIENTSERVER_APITOOLKIT_DIR}/*.c))

S2OPC_CLIENTSERVER_CONFIGURATION_OBJ := $(patsubst %.c,%,$(wildcard ${S2OPC_CLIENTSERVER_CONFIGURATION_DIR}/*.c)) ${S2OPC_CLIENTSERVER_CONFIGURATION_DIR}/sopc_toolkit_build_info

S2OPC_FRONTEND_CLIENTWRAPPER_OBJ := $(patsubst %.c,%,$(filter-out %xml.c,$(wildcard ${S2OPC_FRONTEND_CLIENTWRAPPER_DIR}/*.c)))

S2OPC_CLIENTWRAPPER_DEPRECATED_OBJ := $(patsubst %.c,%,$(wildcard ${S2OPC_CLIENTWRAPPER_DEPRECATED_DIR}/*.c))

S2OPC_CLIENTWRAPPER_INTERNAL_OBJ := $(patsubst %.c,%,$(wildcard ${S2OPC_CLIENTWRAPPER_INTERNAL_DIR}/*.c))

S2OPC_FRONTEND_COMMONWRAPPER_OBJ := $(patsubst %.c,%,$(wildcard ${S2OPC_FRONTEND_COMMONWRAPPER_DIR}/*.c))

S2OPC_FRONTEND_HELPERWRAPPER_OBJ := $(patsubst %.c,%,$(wildcard ${S2OPC_FRONTEND_HELPERWRAPPER_DIR}/*.c))

S2OPC_FRONTEND_SERVERWRAPPER_OBJ := $(patsubst %.c,%,$(filter-out %xml.c,$(wildcard ${S2OPC_FRONTEND_SERVERWRAPPER_DIR}/*.c)))

S2OPC_SERVERWRAPPER_INTERNAL_OBJ := $(patsubst %.c,%,$(wildcard ${S2OPC_SERVERWRAPPER_INTERNAL_DIR}/*.c))

S2OPC_CLIENTSERVER_SECURECHANNELS_OBJ := $(patsubst %.c,%,$(wildcard ${S2OPC_CLIENTSERVER_SECURECHANNELS_DIR}/*.c))

S2OPC_CLIENTSERVER_SERVICES_OBJ := $(patsubst %.c,%,$(wildcard ${S2OPC_CLIENTSERVER_SERVICES_DIR}/*.c))

S2OPC_SERVICES_B2C_OBJ := $(patsubst %.c,%,$(wildcard ${S2OPC_SERVICES_B2C_DIR}/*.c))

S2OPC_SERVICES_BGENC_OBJ := $(patsubst %.c,%,$(wildcard ${S2OPC_SERVICES_BGENC_DIR}/*.c))

S2OPC_CLIENTSERVER_SOCKETS_OBJ := $(patsubst %.c,%,$(wildcard ${S2OPC_CLIENTSERVER_SOCKETS_DIR}/*.c))

S2OPC_MODLISTCLIENTSERVER += ${S2OPC_CLIENTSERVER_APITOOLKIT_OBJ} \
		${S2OPC_CLIENTSERVER_CONFIGURATION_OBJ} \
		${S2OPC_FRONTEND_CLIENTWRAPPER_OBJ} \
		${S2OPC_CLIENTWRAPPER_INTERNAL_OBJ} \
		${S2OPC_FRONTEND_COMMONWRAPPER_OBJ} \
		${S2OPC_FRONTEND_HELPERWRAPPER_OBJ} \
		${S2OPC_FRONTEND_SERVERWRAPPER_OBJ} \
		${S2OPC_SERVERWRAPPER_INTERNAL_OBJ} \
		${S2OPC_CLIENTSERVER_SECURECHANNELS_OBJ} \
		${S2OPC_SERVICES_B2C_OBJ} \
		${S2OPC_SERVICES_BGENC_OBJ} \
		${S2OPC_CLIENTSERVER_SERVICES_OBJ} \
		${S2OPC_CLIENTSERVER_SOCKETS_OBJ} \
		${S2OPC_ADDRESSSPACE_OBJ}


## Discard Warning TODO this warning should be look more closely
#$(ODIR)/${S2OPC_CLIENTSERVER_SECURECHANNELS_DIR}/sopc_secure_connection_state_mgr.o: ${S2OPC_CLIENTSERVER_SECURECHANNELS_DIR}/sopc_secure_connection_state_mgr $(MAKEFILE_LIST)
#	@test -d "$(@D)" || mkdir -p "$(@D)"
#ifneq ($(PIKEOS_COMPILATION_DEPENDENCY),false)
#	@test -d "$(DEPDIR)/$(*D)" || mkdir -p "$(DEPDIR)/$(*D)"
#endif
#ifneq ($(ARTIFACT_FLAGS_C),)
#	$(CC) $(ARTIFACT_FLAGS_C)  -Wno-discarded-qualifiers -o $@ $<
#else
#	$(call run_cmd,CC $@,$(CC) $(CPPFLAGS) $(CFLAGS)  -Wno-discarded-qualifiers $(DEP_FLAGS) -o $@ -c $<)
#endif

endif