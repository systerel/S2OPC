<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>S2OPC OPCUA Toolkit: src/Common/crypto/sopc_pki_stack.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">S2OPC OPCUA Toolkit
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_ba210d1fa67db7bee1bb22e0a3c11d9f.html">Common</a></li><li class="navelem"><a class="el" href="dir_c25c91c352277bc0358fb0cbf526f48d.html">crypto</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sopc_pki_stack.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Defines the minimal PKI implementation provided by the stack.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="sopc__crypto__provider_8h_source.html">sopc_crypto_provider.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sopc__key__manager_8h_source.html">sopc_key_manager.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sopc__pki_8h_source.html">sopc_pki.h</a>&quot;</code><br />
</div>
<p><a href="sopc__pki__stack_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:addc3920202dc558793e478329dd71dd6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="libs2opc__client_8h.html#a8419f6ec9e9cf6f33b24806124972652">SOPC_ReturnStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sopc__pki__stack_8h.html#addc3920202dc558793e478329dd71dd6">SOPC_PKIProviderStack_Create</a> (<a class="el" href="sopc__key__manager_8h.html#ac1d234ff004944cb50101fb24e8cc0cf">SOPC_SerializedCertificate</a> *pCertAuth, <a class="el" href="structSOPC__CRLList.html">SOPC_CRLList</a> *pRevocationList, <a class="el" href="structSOPC__PKIProvider.html">SOPC_PKIProvider</a> **ppPKI)</td></tr>
<tr class="memdesc:addc3920202dc558793e478329dd71dd6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates the minimal validation implementation provided by the stack, which fulfills the <a class="el" href="structSOPC__PKIProvider.html" title="The PKIProvider object defines the common interface for the Public Key Infrastructure.">SOPC_PKIProvider</a> interface.  <a href="sopc__pki__stack_8h.html#addc3920202dc558793e478329dd71dd6">More...</a><br /></td></tr>
<tr class="separator:addc3920202dc558793e478329dd71dd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2aa7f621748722cd0af5b89df927194a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="libs2opc__client_8h.html#a8419f6ec9e9cf6f33b24806124972652">SOPC_ReturnStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sopc__pki__stack_8h.html#a2aa7f621748722cd0af5b89df927194a">SOPC_PKIProviderStack_CreateFromPaths</a> (char **lPathTrustedIssuerRoots, char **lPathTrustedIssuerLinks, char **lPathUntrustedIssuerRoots, char **lPathUntrustedIssuerLinks, char **lPathIssuedCerts, char **lPathCRL, <a class="el" href="structSOPC__PKIProvider.html">SOPC_PKIProvider</a> **ppPKI)</td></tr>
<tr class="memdesc:a2aa7f621748722cd0af5b89df927194a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a SOPC_PKIProviderStack using lists of paths.  <a href="sopc__pki__stack_8h.html#a2aa7f621748722cd0af5b89df927194a">More...</a><br /></td></tr>
<tr class="separator:a2aa7f621748722cd0af5b89df927194a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Defines the minimal PKI implementation provided by the stack. </p>
<p>The stack will not to provide a full-blown configurable PKI. The stack provides only a minimal, always safe validating PKI. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="addc3920202dc558793e478329dd71dd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#addc3920202dc558793e478329dd71dd6">&#9670;&nbsp;</a></span>SOPC_PKIProviderStack_Create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="libs2opc__client_8h.html#a8419f6ec9e9cf6f33b24806124972652">SOPC_ReturnStatus</a> SOPC_PKIProviderStack_Create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sopc__key__manager_8h.html#ac1d234ff004944cb50101fb24e8cc0cf">SOPC_SerializedCertificate</a> *&#160;</td>
          <td class="paramname"><em>pCertAuth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structSOPC__CRLList.html">SOPC_CRLList</a> *&#160;</td>
          <td class="paramname"><em>pRevocationList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structSOPC__PKIProvider.html">SOPC_PKIProvider</a> **&#160;</td>
          <td class="paramname"><em>ppPKI</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates the minimal validation implementation provided by the stack, which fulfills the <a class="el" href="structSOPC__PKIProvider.html" title="The PKIProvider object defines the common interface for the Public Key Infrastructure.">SOPC_PKIProvider</a> interface. </p>
<p>This verifies the certificate in the safest manner (whole certificate chain, with date validation), with a single certificate authority, and its revocation list. Certificate authority requirements depend on the chosen OPC UA security policy. The CRL must be the CRL of the certificate authority.</p>
<dl class="section warning"><dt>Warning</dt><dd>Provided certificates must be valid until the destruction of the created PKI (they are not copied).</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pCertAuth</td><td>A valid pointer to the serialized certificate of the certification authority. This object is internally copied, and only the internal copy is freed by SOPC_PKIProvider_Free. </td></tr>
    <tr><td class="paramname">pRevocationList</td><td>An certificate chain containing the revocation list of the certificate authority. This object is borrowed and is freed by SOPC_PKIProvider_Free. </td></tr>
    <tr><td class="paramname">ppPKI</td><td>A valid pointer to the newly created <a class="el" href="structSOPC__PKIProvider.html" title="The PKIProvider object defines the common interface for the Public Key Infrastructure.">SOPC_PKIProvider</a>. You should free such provider with <a class="el" href="sopc__pki_8h.html#a4d532205ec7e1de3183d1f9baf3d8029" title="Free a PKI provider.">SOPC_PKIProvider_Free()</a>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Content of the pki is unspecified when return value is not SOPC_STATUS_OK.</dd>
<dd>
The pki is not safe to share across threads.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>SOPC_STATUS_OK when successful, SOPC_STATUS_INVALID_PARAMETERS when parameters are NULL, and SOPC_STATUS_NOK when there was an error. </dd></dl>

</div>
</div>
<a id="a2aa7f621748722cd0af5b89df927194a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2aa7f621748722cd0af5b89df927194a">&#9670;&nbsp;</a></span>SOPC_PKIProviderStack_CreateFromPaths()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="libs2opc__client_8h.html#a8419f6ec9e9cf6f33b24806124972652">SOPC_ReturnStatus</a> SOPC_PKIProviderStack_CreateFromPaths </td>
          <td>(</td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>lPathTrustedIssuerRoots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>lPathTrustedIssuerLinks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>lPathUntrustedIssuerRoots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>lPathUntrustedIssuerLinks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>lPathIssuedCerts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>lPathCRL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structSOPC__PKIProvider.html">SOPC_PKIProvider</a> **&#160;</td>
          <td class="paramname"><em>ppPKI</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a SOPC_PKIProviderStack using lists of paths. </p>
<p>This verifies the certificate in the safest manner (whole certificate chain, with date validation, mandatory certificate revocation lists). Certificate Authority (CA) requirements (such as the hash algorithm used for the signature) depend on the chosen OPC UA security policy.</p>
<p>There are 3 types of certificates to provide to the PKI:</p><ul>
<li>The "trusted issuers" are CAs which issued certificates are also trusted. All the certificates of the signing chain including the root CA must be provided.</li>
<li>The "issued certificates" are certificates issued by untrusted CA. These certificates are considered trustworthy. The difference between trusted issuers and trusted issued certificates is that issued certificates are trusted on a one by one basis, whereas the trusted issuer may emit a large number of trusted certificates.</li>
<li>The "untrusted issuers" are CAs that are used to verify the signing chain of the "issued certificates". Each issued certificate must have its whole signing CA chain in the untrusted issuers or the trusted issuers up to the root CA.</li>
</ul>
<p>In addition, there are two more concepts:</p><ul>
<li>A link CA is part of the certificate validation chain. All links between a certificate and a root certificate must be provided.</li>
<li>A root CA is all always trusted, even if there are other root CAs that signed it. Hence the parent of root CAs will never be checked, and the validation stops on root CAs.</li>
</ul>
<p>The list of Certificate Revocation List (CRL) must contain exactly one list for each CA of the provided CAs, either link or root, trusted or untrusted.</p>
<p>Issued certificates should not have CRLs, as they cannot be used to trust any other certificate. When an issued certificate is used to protect a Secure Channel, it's signing chain will be verified. For instance, if the certificate is not self signed and appears on the CRL of its signing CA, the connection will fail as the certificate is in fact invalid.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lPathTrustedIssuerRoots</td><td>A pointer to an array of paths to root trusted issuers of the validation chains. The array must contain a NULL pointer to indicate its end. Each path is a zero-terminated relative path to the certificate from the current working directory. </td></tr>
    <tr><td class="paramname">lPathTrustedIssuerLinks</td><td>A pointer to an array of paths to intermediate certificate authorities. This list contain only the trusted intermediate issuers. This list must be ordered so that certificate signed by a parent must be present in the list before its signing parent. Each issued certificate must have its signing certificate chain in this list. </td></tr>
    <tr><td class="paramname">lPathUntrustedIssuerRoots</td><td>A pointer to an array of paths to root untrusted issuers of the validation chains. The array must contain a NULL pointer to indicate its end. Each path is a zero-terminated relative path to the certificate from the current working directory. </td></tr>
    <tr><td class="paramname">lPathUntrustedIssuerLinks</td><td>A pointer to an array of paths to intermediate certificate authorities. This list contain only the untrusted intermediate issuers. This list must be ordered so that certificate signed by a parent must be present in the list before its signing parent. Each issued certificate must have its signing certificate chain in this list. </td></tr>
    <tr><td class="paramname">lPathIssuedCerts</td><td>A pointer to an array of paths to issued certificates. The array must contain a NULL pointer to indicate its end. Each path is a zero-terminated relative path to the certificate from the current working directory. </td></tr>
    <tr><td class="paramname">lPathCRL</td><td>A pointer to an array of paths to each certificate revocation list to use. Each CA of the trusted issuers list and the untrusted issuers list must have a CRL in the list. The array must contain a NULL pointer to indicate its end. Each path is a zero-terminated relative path to the CRL from the current working directory. </td></tr>
    <tr><td class="paramname">ppPKI</td><td>A valid pointer to the newly created PKIProvider. You should free such provider with <a class="el" href="sopc__pki_8h.html#a4d532205ec7e1de3183d1f9baf3d8029" title="Free a PKI provider.">SOPC_PKIProvider_Free()</a>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section warning"><dt>Warning</dt><dd>The <code>lPathTrustedIssuerLinks</code> and <code>lPathUntrustedIssuerLinks</code> must be sorted: certificates must be provided in the child -&gt; parent order. In other words, there may be several chains provided in the list, but a signed certificate must always be provided before the certificate that signed it.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Content of the pki is unspecified when return value is not SOPC_STATUS_OK.</dd>
<dd>
The pki is not safe to share across threads.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>SOPC_STATUS_OK when successful, SOPC_STATUS_INVALID_PARAMETERS when parameters are NULL, and SOPC_STATUS_NOK when there was an error. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 7 2021 09:35:45 for S2OPC OPCUA Toolkit by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
