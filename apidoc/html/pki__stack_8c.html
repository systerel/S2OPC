<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>S2OPC OPCUA Toolkit: csrc/crypto/mbedtls/pki_stack.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">S2OPC OPCUA Toolkit
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_dfb40522c510869b08da8f8e2e259a6f.html">csrc</a></li><li class="navelem"><a class="el" href="dir_9a863ddc9a315fb4abd8dbdde740529e.html">crypto</a></li><li class="navelem"><a class="el" href="dir_26e3e16c89cd199088e577920035d7a5.html">mbedtls</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">pki_stack.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;assert.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &quot;<a class="el" href="sopc__crypto__provider_8h_source.html">sopc_crypto_provider.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sopc__key__manager_8h_source.html">sopc_key_manager.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sopc__logger_8h_source.html">sopc_logger.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sopc__macros_8h_source.html">sopc_macros.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sopc__mem__alloc_8h_source.html">sopc_mem_alloc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sopc__pki_8h_source.html">sopc_pki.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sopc__pki__stack_8h_source.html">sopc_pki_stack.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="key__manager__lib_8h_source.html">key_manager_lib.h</a>&quot;</code><br />
<code>#include &quot;mbedtls/oid.h&quot;</code><br />
<code>#include &quot;mbedtls/x509.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:addc3920202dc558793e478329dd71dd6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sopc__enums_8h.html#a8419f6ec9e9cf6f33b24806124972652">SOPC_ReturnStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pki__stack_8c.html#addc3920202dc558793e478329dd71dd6">SOPC_PKIProviderStack_Create</a> (<a class="el" href="sopc__key__manager_8h.html#ac1d234ff004944cb50101fb24e8cc0cf">SOPC_SerializedCertificate</a> *pCertAuth, <a class="el" href="structSOPC__CRLList.html">SOPC_CRLList</a> *pRevocationList, <a class="el" href="structSOPC__PKIProvider.html">SOPC_PKIProvider</a> **ppPKI)</td></tr>
<tr class="memdesc:addc3920202dc558793e478329dd71dd6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates the minimal validation implementation provided by the stack, which fulfills the <a class="el" href="structSOPC__PKIProvider.html" title="The PKIProvider object defines the common interface for the Public Key Infrastructure. ">SOPC_PKIProvider</a> interface.  <a href="#addc3920202dc558793e478329dd71dd6">More...</a><br /></td></tr>
<tr class="separator:addc3920202dc558793e478329dd71dd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ab164b8bee138d26c4a45f775e89b80"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sopc__enums_8h.html#a8419f6ec9e9cf6f33b24806124972652">SOPC_ReturnStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pki__stack_8c.html#a8ab164b8bee138d26c4a45f775e89b80">SOPC_PKIProviderStack_CreateFromPaths</a> (char **lPathCA, char **lPathCRL, <a class="el" href="structSOPC__PKIProvider.html">SOPC_PKIProvider</a> **ppPKI)</td></tr>
<tr class="memdesc:a8ab164b8bee138d26c4a45f775e89b80"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a SOPC_PKIProviderStack using lists of paths.  <a href="#a8ab164b8bee138d26c4a45f775e89b80">More...</a><br /></td></tr>
<tr class="separator:a8ab164b8bee138d26c4a45f775e89b80"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The minimal PKI implementation provided by the stack. It is lib-specific.</p>
<p>This is not the role of the stack to provide a full-blown configurable PKI. The stack provides only a minimal, always safe validating PKI. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="addc3920202dc558793e478329dd71dd6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sopc__enums_8h.html#a8419f6ec9e9cf6f33b24806124972652">SOPC_ReturnStatus</a> SOPC_PKIProviderStack_Create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sopc__key__manager_8h.html#ac1d234ff004944cb50101fb24e8cc0cf">SOPC_SerializedCertificate</a> *&#160;</td>
          <td class="paramname"><em>pCertAuth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structSOPC__CRLList.html">SOPC_CRLList</a> *&#160;</td>
          <td class="paramname"><em>pRevocationList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structSOPC__PKIProvider.html">SOPC_PKIProvider</a> **&#160;</td>
          <td class="paramname"><em>ppPKI</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates the minimal validation implementation provided by the stack, which fulfills the <a class="el" href="structSOPC__PKIProvider.html" title="The PKIProvider object defines the common interface for the Public Key Infrastructure. ">SOPC_PKIProvider</a> interface. </p>
<p>This verifies the certificate in the safest manner (whole certificate chain, with date validation), with a single certificate authority, and its revocation list. Certificate authority requirements depend on the chosen OPC UA security policy. The CRL must be the CRL of the certificate authority.</p>
<dl class="section warning"><dt>Warning</dt><dd>Provided certificates must be valid until the destruction of the created PKI (they are not copied).</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pCertAuth</td><td>A valid pointer to the serialized certificate of the certification authority. This object is internally copied, and only the internal copy is freed by SOPC_PKIProvider_Free. </td></tr>
    <tr><td class="paramname">pRevocationList</td><td>An certificate chain containing the revocation list of the certificate authority. This object is borrowed and is freed by SOPC_PKIProvider_Free. </td></tr>
    <tr><td class="paramname">ppPKI</td><td>A valid pointer to the newly created <a class="el" href="structSOPC__PKIProvider.html" title="The PKIProvider object defines the common interface for the Public Key Infrastructure. ">SOPC_PKIProvider</a>. You should free such provider with <a class="el" href="sopc__pki_8c.html#a4d532205ec7e1de3183d1f9baf3d8029" title="Free a PKI provider. ">SOPC_PKIProvider_Free()</a>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Content of the pki is unspecified when return value is not SOPC_STATUS_OK.</dd>
<dd>
The pki is not safe to share across threads.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>SOPC_STATUS_OK when successful, SOPC_STATUS_INVALID_PARAMETERS when parameters are NULL, and SOPC_STATUS_NOK when there was an error. </dd></dl>

</div>
</div>
<a class="anchor" id="a8ab164b8bee138d26c4a45f775e89b80"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sopc__enums_8h.html#a8419f6ec9e9cf6f33b24806124972652">SOPC_ReturnStatus</a> SOPC_PKIProviderStack_CreateFromPaths </td>
          <td>(</td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>lPathCA</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>lPathCRL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structSOPC__PKIProvider.html">SOPC_PKIProvider</a> **&#160;</td>
          <td class="paramname"><em>ppPKI</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a SOPC_PKIProviderStack using lists of paths. </p>
<p>This verifies the certificate in the safest manner (whole certificate chain, with date validation, mandatory certificate revocation lists). Certificate Authority (CA) requirements depend on the chosen OPC UA security policy. The list of Certificate Revocation List (CRL) must contain exactly one list for each CA of the CA list.</p>
<p>Issued certificates are also accepted (certificates whose chain is not trusted) and must be added to the certificate authority list. Issued certificates are always trusted, they cannot be revoked, as they cannot appear on a CRL of a trusted CA. They have no CRL, as they don't sign other certificates (otherwise, they are regular CAs).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lPathCA</td><td>A pointer to an array of paths to each certificate (or trusted certificate) to use in the validation chain. The array must contain a NULL pointer to indicate its end. Each path is a zero-terminated relative path to the certificate from the current working directory. </td></tr>
    <tr><td class="paramname">lPathCRL</td><td>A pointer to an array of paths to each certificate revocation list to use. Each certificate of the CA list must have a valid CRL in the CRL list. The array must contain a NULL pointer to indicate its end. Each path is a zero-terminated relative path to the CRL from the current working directory. </td></tr>
    <tr><td class="paramname">ppPKI</td><td>A valid pointer to the newly created PKIProvider. You should free such provider with <a class="el" href="sopc__pki_8c.html#a4d532205ec7e1de3183d1f9baf3d8029" title="Free a PKI provider. ">SOPC_PKIProvider_Free()</a>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Content of the pki is unspecified when return value is not SOPC_STATUS_OK.</dd>
<dd>
The pki is not safe to share across threads.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>SOPC_STATUS_OK when successful, SOPC_STATUS_INVALID_PARAMETERS when parameters are NULL, and SOPC_STATUS_NOK when there was an error. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Nov 27 2019 21:38:28 for S2OPC OPCUA Toolkit by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
