<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>S2OPC OPCUA Toolkit: S2OPC Toolkit API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">S2OPC OPCUA Toolkit
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">S2OPC Toolkit API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>The S2OPC OPC UA Toolkit provides a Client/Server C source code implementation including an OPC UA communication stack, B model and C source code implementation for a minimal set of services and a cryptographic library adaptation for OPC UA needs (using mbedtls). S2OPC also provides a PubSub C source code implementation, it shares some components with Client/Server part (cryptographic services, OPC UA types, etc.).</p>
<p>For further details on supported features see the <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/README.md">README.md file</a> content. Additional information on how to build, configure and use S2OPC is also available on <a href="https://gitlab.com/systerel/S2OPC/-/wikis/home">the wiki</a>.</p>
<p>The following sections only concern the C source documentation.</p>
<p>You will find documentation on the Python binding for S2OPC on following page: <a href="pys2opc/index.html">Go to PyS2OPC documentation</a></p>
<h1><a class="anchor" id="common"></a>
High-level Common API</h1>
<p>The high-level common API shall be used to initialize (or clear) the S2OPC toolkit prior to use (or after using) the high-level client/server API or pubsub API. Those functions are shared between all high-level API when including the S2OPC Common library:</p><ul>
<li><a class="el" href="sopc__common_8h.html#a988d1ae770f8834d743a8fe6814bac4d" title="Initializes Common module.">SOPC_Common_Initialize</a> shall be called before any other high-level API function to initialize S2OPC toolkits.</li>
<li><a class="el" href="sopc__common_8h.html#a429115cabdaa1fee6598d305589f84ba" title="clear common library (including logs)">SOPC_Common_Clear</a> shall be called after any other high-level API function to clear S2OPC toolkits.</li>
<li><a class="el" href="sopc__common_8h.html#af3b7be29145e1fd651a457c8fd487d35" title="retrieve the default log configuration">SOPC_Common_GetDefaultLogConfiguration</a> retrieve default log configuration.</li>
</ul>
<h1><a class="anchor" id="common_client_server"></a>
High-level Common Client/Server API</h1>
<p>The high-level common Client/Server API shall be used to initialize (or clear) the S2OPC toolkit prior to use (or after using) the high-level client/server API. Those functions are shared between high-level server/client API:</p><ul>
<li><a class="el" href="libs2opc__common__config_8h.html#a6e9c2bb423d47704a9f3419b12ce89e8" title="Initialize the S2OPC Client/Server frontend library (start threads, initialize configuration,...">SOPC_CommonHelper_Initialize</a> shall be called before any other high-level API function to initialize S2OPC client/server tooklit.</li>
<li><a class="el" href="libs2opc__common__config_8h.html#a14d175392ac56406fafc6081937c0c20" title="Clear the S2OPC Client/Server frontend library (stop threads, clear common configuration,...">SOPC_CommonHelper_Clear</a> shall be called after any other high-level API function to clear S2OPC client/server tooklit.</li>
<li><a class="el" href="libs2opc__common__config_8h.html#a65960e840aec20a21a76f7e24c3235d6" title="Retrieve the S2OPC Client/Server frontend library build info (version, date, etc.)....">SOPC_CommonHelper_GetBuildInfo</a> provides S2OPC client/server toolkit build info.</li>
</ul>
<h1><a class="anchor" id="server"></a>
High-level Server API</h1>
<p>The high-level server API provides functions for configuration (endpoints and security, address space content, user management, etc.) and functions to manage server execution (start/stop, local service execution, etc.).</p>
<p>The main configuration functions are defined by <a class="el" href="libs2opc__server__config_8h.html" title="High level interface to configure an OPC UA server.">libs2opc_server_config.h</a>:</p><ul>
<li><a class="el" href="libs2opc__server__config_8h.html#aeb8cc21ce7fd7d67ce75c748e5208a40" title="Initialize the S2OPC Server frontend configuration Call to SOPC_HelperConfigServer_Initialize is requ...">SOPC_HelperConfigServer_Initialize</a> shall be called before any other function of the server wrapper module (and after <a class="el" href="libs2opc__common__config_8h.html#a6e9c2bb423d47704a9f3419b12ce89e8" title="Initialize the S2OPC Client/Server frontend library (start threads, initialize configuration,...">SOPC_CommonHelper_Initialize</a>).</li>
<li><a class="el" href="libs2opc__server__config_8h.html#acfbdc9405c46df4e2db1586726badef0" title="Clear the S2OPC Server frontend configuration It shall be done before a call to SOPC_CommonHelper_Cle...">SOPC_HelperConfigServer_Clear</a> shall be called when server wrapper module is not used anymore.</li>
<li><a class="el" href="libs2opc__server__config_8h.html#a0edcc45ce3c5517e5c31408733abd0ae" title="Configure server from XML configuration files for: server endpoints, address space and users credenti...">SOPC_HelperConfigServer_ConfigureFromXML</a> loads configuration from XML configuration files (server endpoints and security, address space, users). See <a class="el" href="index.html#xml_config">XML file examples</a>.</li>
<li><a class="el" href="libs2opc__server__config_8h.html#aadcb25676febca9f246c4e42c65f13a7" title="Method Call service configuration.">SOPC_HelperConfigServer_SetMethodCallManager</a> sets a manager for callbacks to use for CallMethod service (available only if s2opc is compiled with WITH_NANO_EXTENDED=1).</li>
<li><a class="el" href="libs2opc__server__config_8h.html#a3a65d61bd41cfc6e1bdc3440fee98de7" title="Define the write notification callback to be used.">SOPC_HelperConfigServer_SetWriteNotifCallback</a> sets a callback to receive notification on address space write operations from clients.</li>
<li><a class="el" href="libs2opc__server__config_8h.html#a982a0d71c51e8d869a789f93099565a7" title="Define the local service response callback to be used.">SOPC_HelperConfigServer_SetLocalServiceAsyncResponse</a> sets a callback to use local services on server in an asynchronous way (see <a class="el" href="libs2opc__server_8h.html#aa7760757945de93872bea0e2c39622ba" title="Executes a local OPC UA service on server (read, write, browse or discovery service) asynchronously....">SOPC_ServerHelper_LocalServiceAsync</a>).</li>
</ul>
<p>In case the dedicated XML configuration files are not used to configure server, use the additional configuration functions located in <a class="el" href="libs2opc__server__config__custom_8h.html" title="Additional server configuration facilities for non-XML configuration of the server or non-essential a...">libs2opc_server_config_custom.h</a>.</p>
<p>The main functions for server execution are defined by <a class="el" href="libs2opc__server_8h.html" title="High level interface to run an OPC UA server.">libs2opc_server.h</a>:</p><ul>
<li><a class="el" href="libs2opc__server_8h.html#af4ba08c235a2a13ad69c927a55071f80" title="Start the server asynchronously. Server information node is updated and endpoints are asynchronously ...">SOPC_ServerHelper_StartServer</a>: starts the server asynchronously, it runs until requested to stop.</li>
<li><a class="el" href="libs2opc__server_8h.html#a63f4ed5c688bdd096abdfb3d54be95c2" title="Call to stop the server started with SOPC_ServerHelper_StartServer. If server started with SOPC_Serve...">SOPC_ServerHelper_StopServer</a>: stops the server.</li>
<li><a class="el" href="libs2opc__server_8h.html#ae5e7086370ec8002d439e256d92486c3" title="Run the server synchronously (alternative to SOPC_ServerHelper_StartServer) Server information node i...">SOPC_ServerHelper_Serve</a> synchronous alternative to <a class="el" href="libs2opc__server_8h.html#af4ba08c235a2a13ad69c927a55071f80" title="Start the server asynchronously. Server information node is updated and endpoints are asynchronously ...">SOPC_ServerHelper_StartServer</a>, it blocks until server stopped.</li>
<li><a class="el" href="libs2opc__server_8h.html#aa7760757945de93872bea0e2c39622ba" title="Executes a local OPC UA service on server (read, write, browse or discovery service) asynchronously....">SOPC_ServerHelper_LocalServiceAsync</a>: execute a local service (read, write, etc.) on server asynchronously, service response is provided through callback defined with <a class="el" href="libs2opc__server__config_8h.html#a982a0d71c51e8d869a789f93099565a7" title="Define the local service response callback to be used.">SOPC_HelperConfigServer_SetLocalServiceAsyncResponse</a>.</li>
<li><a class="el" href="libs2opc__server_8h.html#a6258a4c6dddd2b9c28e635488e437823" title="Executes a local OPC UA service on server (read, write, browse or discovery service) synchronously.">SOPC_ServerHelper_LocalServiceSync</a>: execute a local service (read, write, etc.) on server synchronously.</li>
</ul>
<p>See implementation examples <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/samples/ClientServer/demo_server/toolkit_demo_server.c">toolkit_demo_server.c</a> (XML configuration only), <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/tests/ClientServer/validation_tests/server/toolkit_test_server_local_service.c">toolkit_test_server_local_service.c</a> (local services), <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/tests/ClientServer/validation_tests/server/toolkit_test_server.c">toolkit_test_server.c</a> (both XML and non-XML configuration) or <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/tests/ClientServer/validation_tests/client/toolkit_test_server_client.c">toolkit_test_server_client.c</a> (both client and server).</p>
<p><a class="anchor" id="xml_config"></a>See XML configuration schemas and examples:</p><ul>
<li>Server endpoints and security <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/schemas/s2opc_clientserver_config.xsd">XSD schema</a> and <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/samples/ClientServer/data/config/S2OPC_Server_Demo_Config.xml">XML example</a></li>
<li>Address space <a href="http://opcfoundation.org/UA/2011/03/UANodeSet.xsd">XSD schema</a> and <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/samples/ClientServer/data/address_space/s2opc_nano.xml">XML example</a></li>
<li>Users <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/schemas/s2opc_clientserver_users_config.xsd">XSD schema</a> and <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/samples/ClientServer/data/config/S2OPC_Users_Demo_Config.xml">XML example</a></li>
</ul>
<h1><a class="anchor" id="sclient"></a>
Simplified Client API</h1>
<p>The simplified client interface consists of functions to configure the connection, to establish the connection, to call GetEndpoint, Write, Read and Browse services, and to create a Subscription and add MonitoredItems to it.</p>
<p>The simplified interface functions and types are defined by <a class="el" href="libs2opc__client__cmds_8h.html" title="Interface of a library supporting the subscription management, read/write operation and browse.">libs2opc_client_cmds.h</a>.</p><ul>
<li><a class="el" href="libs2opc__client__cmds_8h.html#adb375ebfd7de6d0ac969a257183fbb2f" title="Configure the library. This function shall be called once by the host application before any other se...">SOPC_ClientHelper_Initialize</a> shall be called before any other function of the module (and after <a class="el" href="libs2opc__common__config_8h.html#a6e9c2bb423d47704a9f3419b12ce89e8" title="Initialize the S2OPC Client/Server frontend library (start threads, initialize configuration,...">SOPC_CommonHelper_Initialize</a>).</li>
<li><a class="el" href="libs2opc__client__cmds_8h.html#adfd1cc14d2113d1994f15fe6260e6515" title="Clears the connections and configurations. It shall be done before a call to SOPC_CommonHelper_Clear.">SOPC_ClientHelper_Finalize</a> shall be called when module not used anymore.</li>
<li><a class="el" href="libs2opc__client__cmds_8h.html#a503e8d8e49a7dcc5a4b938e32bdc70c0" title="Sends a GetEndpoints request to the endpointUrl and provide the results.">SOPC_ClientHelper_GetEndpoints</a>: calls GetEndpoints service of a server and returns when server response received or error occurred (connection failure, response timeout).</li>
<li><a class="el" href="libs2opc__client__cmds_8h.html#a036d912f9ffae3a81005c289db27d2e1" title="Creates a new configuration to connect to a remote OPC server. Return a configuration id or error cod...">SOPC_ClientHelper_CreateConfiguration</a>: creates a connection configuration (security properties, session user, etc.) to be used for non-discovery services.</li>
<li><a class="el" href="libs2opc__client__cmds_8h.html#ae3bcba1c16ed1fd13e6cb9010c763168" title="Creates a new connection to a remote OPC server. The connection represent the whole client and is lat...">SOPC_ClientHelper_CreateConnection</a>: creates a connection (secure channel + session) to the server given the connection configuration identifier created previously.</li>
<li><a class="el" href="libs2opc__client__cmds_8h.html#a07aeac13d231b82a1d2009c635a369b6" title="Disconnect from a remote OPC server. The function waits until the client is effectively disconnected,...">SOPC_ClientHelper_Disconnect</a>: disconnect the previously created connection given the connection identifier.</li>
<li><a class="el" href="libs2opc__client__cmds_8h.html#a6d1dca87a8b5b4e906f5ebeac56ed772" title="Write values to attributes &quot;Value&quot; of one or more Nodes. This function waits for the server response,...">SOPC_ClientHelper_Write</a>: calls Write service through given connection and returns when server response received.</li>
<li><a class="el" href="libs2opc__client__cmds_8h.html#a40df5ba0349fed7dbf3256d53791002f" title="Read one or more attributes of one or more Nodes. Return both the source and Server timestamps for ea...">SOPC_ClientHelper_Read</a>: calls Read service through given connection and returns when server response received.</li>
<li><a class="el" href="libs2opc__client__cmds_8h.html#a3b3af52a07597cca364db6ec0dec0fc5" title="Discover the references of a Node using Browse and browseNext services. If Browse Response returns Co...">SOPC_ClientHelper_Browse</a>: calls Browse service through given connection and returns when server response received.</li>
<li><a class="el" href="libs2opc__client__cmds_8h.html#acfc7f131bbb1239d2ad6aa2c9ea6b3cf" title="Create a subscription associated to the given connection The given callback will be called on data ch...">SOPC_ClientHelper_CreateSubscription</a>: calls CreateSubscription service through given connection. The subscription is created and publish requests / responses automatically managed by the client helper.</li>
<li><a class="el" href="libs2opc__client__cmds_8h.html#a9e862f0c4b256b0fbcc4b6cbec54a516" title="Adds monitored items to the subscription associated to the given connection. SOPC_ClientHelper_Create...">SOPC_ClientHelper_AddMonitoredItems</a>: calls CreateMonitoredItem service through given connection with a subscription successfully created previously.</li>
<li><a class="el" href="libs2opc__client__cmds_8h.html#a4999712e460ae7e22ccc2ae64e7d4333" title="Delete subscription associated to the given connection. If this function succeed, no more data change...">SOPC_ClientHelper_Unsubscribe</a>: stops the subscription associated to the given connection.</li>
</ul>
<p>See implementation examples <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/samples/ClientServer/client_wrapper/examples">&lt;service&gt;.c</a> or <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/samples/ClientServer/client_wrapper/client_subscription.c">client_subscription.c</a>.</p>
<h1><a class="anchor" id="lclient"></a>
Low-level client API</h1>
<p>Main configuration functions and types for client are provided by <a class="el" href="sopc__toolkit__config_8h.html" title="This module shall be used to initialize, configure and clear/terminate the toolkit execution.">sopc_toolkit_config.h</a> and <a class="el" href="sopc__user__app__itf_8h.html" title="Contains the types to be used by the user application to use the Toolkit.">sopc_user_app_itf.h</a>. The functions with <code>SOPC_ToolkitServer_</code> prefix shall be ignored.</p>
<ul>
<li>(Optional) log configuration with <a class="el" href="sopc__common_8h.html#a988d1ae770f8834d743a8fe6814bac4d" title="Initializes Common module.">SOPC_Common_Initialize</a></li>
<li><a class="el" href="sopc__toolkit__config_8h.html#a1082879b9ca7992065d7a03b16e60be9" title="Initialize the toolkit configuration, libraries and threads.">SOPC_Toolkit_Initialize</a> initializes the toolkit and configure the <a class="el" href="sopc__user__app__itf_8h.html#a20861cf43223f7b171bc951e9c751143" title="Toolkit communication events application callback type.">SOPC_ComEvent_Fct</a> application callback to manage received events from toolkit.</li>
<li><a class="el" href="sopc__toolkit__config_8h.html#ae7cefe366a3471f9c1225843a8c6b37c" title="Record the given secure channel configuration for endpoint connection in returned index (SOPC_Toolkit...">SOPC_ToolkitClient_AddSecureChannelConfig</a> adds a new secure channel configuration (<a class="el" href="structSOPC__SecureChannel__Config.html" title="Client configuration of a Secure Channel.">SOPC_SecureChannel_Config</a>). In case security is used, the default PKI provider might be used (<a class="el" href="sopc__pki__stack_8h.html" title="Defines the minimal PKI implementation provided by the stack.">sopc_pki_stack.h</a>) and certficates shall be loaded (<a class="el" href="sopc__key__manager_8h.html" title="The SOPC_KeyManager provides an API for Asymmetric Key Management such as loading signed public keys ...">sopc_key_manager.h</a>).</li>
<li><a class="el" href="sopc__toolkit__config_8h.html#a7f8d525103f8edaa073a8b6edde0ad7e" title="Clear the stack configuration.">SOPC_Toolkit_Clear</a> shall be called when toolkit is not used anymore.</li>
</ul>
<p>Once toolkit is intitialized and a secure channel configuration is added, the client is able to establish connection:</p><ul>
<li><a class="el" href="sopc__toolkit__async__api_8h.html#a1429b94ce1bf1ad57ed4a5a9844cf9d1" title="Request to activate a new session for the given endpoint connection configuration as client.">SOPC_ToolkitClient_AsyncActivateSession</a> to establish a secure channel and activate a session with given user token.</li>
<li><a class="el" href="sopc__toolkit__async__api_8h.html#ab65a954634ac0d72ac0d55ae7a080dfd" title="Request to activate an anonymous session. See SOPC_ToolkitClient_AsyncActivateSession()">SOPC_ToolkitClient_AsyncActivateSession_Anonymous</a> simplified version of <a class="el" href="sopc__toolkit__async__api_8h.html#a1429b94ce1bf1ad57ed4a5a9844cf9d1" title="Request to activate a new session for the given endpoint connection configuration as client.">SOPC_ToolkitClient_AsyncActivateSession</a> for anonymous user.</li>
<li><a class="el" href="sopc__toolkit__async__api_8h.html#a1f5a379d89b08190ed577811e069ccd6" title="Request to activate a session with a UserNameIdentityToken. See SOPC_ToolkitClient_AsyncActivateSessi...">SOPC_ToolkitClient_AsyncActivateSession_UsernamePassword</a> simplified version of <a class="el" href="sopc__toolkit__async__api_8h.html#a1429b94ce1bf1ad57ed4a5a9844cf9d1" title="Request to activate a new session for the given endpoint connection configuration as client.">SOPC_ToolkitClient_AsyncActivateSession</a> for using UserName.</li>
</ul>
<p>Session activation result is provided by event <a class="el" href="sopc__user__app__itf_8h.html#a887f1dd52095dbd128e4df7be970048fa4af175c0660dee162bcbf0266855bd08">SE_ACTIVATED_SESSION</a> through the configured <a class="el" href="sopc__user__app__itf_8h.html#a20861cf43223f7b171bc951e9c751143" title="Toolkit communication events application callback type.">SOPC_ComEvent_Fct</a> callback, resulting session identifier is necessary to send requests through a session.</p>
<p>It is also possible to send discovery services requests to through a configured connection without session using:</p><ul>
<li><a class="el" href="sopc__toolkit__async__api_8h.html#ac2a3bdc283d7e72c34ebbc650577cb66" title="Request to send a discovery service request without using session.">SOPC_ToolkitClient_AsyncSendDiscoveryRequest</a> establishes a secure channel without session and send the given request. Response received with event <a class="el" href="sopc__user__app__itf_8h.html#a887f1dd52095dbd128e4df7be970048faf03070caeb357f90917f5caf0774fed5">SE_RCV_DISCOVERY_RESPONSE</a> through <a class="el" href="sopc__user__app__itf_8h.html#a20861cf43223f7b171bc951e9c751143" title="Toolkit communication events application callback type.">SOPC_ComEvent_Fct</a> callback.</li>
</ul>
<p>Once a session has been activated it will be possible to send all kind of requests using the session identifier to call:</p><ul>
<li><a class="el" href="sopc__toolkit__async__api_8h.html#abd6c852c5204b361fd00edcfeead945d" title="Request to send a service request on given active session.">SOPC_ToolkitClient_AsyncSendRequestOnSession</a>. Response are received with event <a class="el" href="sopc__user__app__itf_8h.html#a887f1dd52095dbd128e4df7be970048fa5ba9b435259047338e5e2d5954cc71d6">SE_RCV_SESSION_RESPONSE</a> through <a class="el" href="sopc__user__app__itf_8h.html#a20861cf43223f7b171bc951e9c751143" title="Toolkit communication events application callback type.">SOPC_ComEvent_Fct</a> callback.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The client API provides raw OPC UA responses to the OPC UA requests sent. Only the secure channel and session services are automatically managed by toolkit. See <a class="el" href="index.html#sclient">Simplified Client API</a> for automated subscription service support.</dd></dl>
<p>See implementation examples <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/tests/ClientServer/validation_tests/client/toolkit_test_client.c">toolkit_test_client.c</a>, and <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/samples/ClientServer/demo_client/">command line tools s2opc_&lt;service&gt;.c</a> for dedicated services (read, write, etc.).</p>
<h1><a class="anchor" id="lserver"></a>
Low-level server API</h1>
<p>Main configuration function and types for server are provided by <a class="el" href="sopc__toolkit__config_8h.html" title="This module shall be used to initialize, configure and clear/terminate the toolkit execution.">sopc_toolkit_config.h</a> and <a class="el" href="sopc__user__app__itf_8h.html" title="Contains the types to be used by the user application to use the Toolkit.">sopc_user_app_itf.h</a>. The functions with <code>SOPC_ToolkitClient_</code> prefix shall be ignored.</p>
<p>Some are shared with <a class="el" href="index.html#lclient">Low-level client API</a> configuration:</p><ul>
<li>(Optional) log configuration with <a class="el" href="sopc__common_8h.html#a988d1ae770f8834d743a8fe6814bac4d" title="Initializes Common module.">SOPC_Common_Initialize</a></li>
<li><a class="el" href="sopc__toolkit__config_8h.html#a1082879b9ca7992065d7a03b16e60be9" title="Initialize the toolkit configuration, libraries and threads.">SOPC_Toolkit_Initialize</a> initializes the toolkit and configure the <a class="el" href="sopc__user__app__itf_8h.html#a20861cf43223f7b171bc951e9c751143" title="Toolkit communication events application callback type.">SOPC_ComEvent_Fct</a> application callback to manage received events from toolkit.</li>
<li><a class="el" href="sopc__toolkit__config_8h.html#a2aba8a0ab9273e8f64f610f069e7eb36" title="Define toolkit configuration as configured and lock its state until toolkit clear operation.">SOPC_ToolkitServer_Configured</a> shall be called once all the configuration steps are terminated.</li>
<li><a class="el" href="sopc__toolkit__config_8h.html#a7f8d525103f8edaa073a8b6edde0ad7e" title="Clear the stack configuration.">SOPC_Toolkit_Clear</a> shall be called when toolkit is not used anymore.</li>
</ul>
<p>For main server configuration there are 2 possible options. The first is to use the XML configuration parser:</p><ul>
<li>Configure with XML file (<a href="https://gitlab.com/systerel/S2OPC/-/blob/master/schemas/s2opc_clientserver_config.xsd">XSD schema</a>, <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/samples/ClientServer/data/config/S2OPC_Server_Demo_Config.xml">XML example</a>) using <a class="el" href="sopc__config__loader_8h.html#a1206a73ac5e509039a3dc0a6effd6be1">SOPC_Config_Parse</a>, it produces a pre-filled <a class="el" href="structSOPC__S2OPC__Config.html" title="S2OPC configuration.">SOPC_S2OPC_Config</a>.</li>
<li>In case security is used, the default PKI provider might be used (<a class="el" href="sopc__pki__stack_8h.html" title="Defines the minimal PKI implementation provided by the stack.">sopc_pki_stack.h</a>) and certificates shall be loaded (<a class="el" href="sopc__key__manager_8h.html" title="The SOPC_KeyManager provides an API for Asymmetric Key Management such as loading signed public keys ...">sopc_key_manager.h</a>) into <a class="el" href="structSOPC__S2OPC__Config.html" title="S2OPC configuration.">SOPC_S2OPC_Config</a> (<a class="el" href="structSOPC__Server__Config.html#aae5c9974adf66fcdb9aa83665a391f60">SOPC_Server_Config::pki</a>, <a class="el" href="structSOPC__Server__Config.html#ab70273de7b6188b69ae426cdee248e57">SOPC_Server_Config::serverCertificate</a>, <a class="el" href="structSOPC__Server__Config.html#a2e85bc556b838336a79bece887309a77">SOPC_Server_Config::serverKey</a>) using certificates paths from <a class="el" href="structSOPC__Server__Config.html" title="OPC UA server configuration structure.">SOPC_Server_Config</a>.</li>
</ul>
<p>The second is to allocate a <a class="el" href="structSOPC__S2OPC__Config.html" title="S2OPC configuration.">SOPC_S2OPC_Config</a> structure and to initialize it using <a class="el" href="sopc__user__app__itf_8h.html#a8b556387df73876939277ae424ea4119" title="Initialize the content of the SOPC_S2OPC_Config. Calls both SOPC_ServerConfig_Initialize and SOPC_Cli...">SOPC_S2OPC_Config_Initialize</a> function, then initialize all <a class="el" href="structSOPC__Server__Config.html" title="OPC UA server configuration structure.">SOPC_Server_Config</a> fields manually.</p>
<p>In both cases the <a class="el" href="index.html#users">User authentication and user authorization managers</a> shall be configured for each <a class="el" href="structSOPC__Endpoint__Config.html" title="Server configuration of a Endpoint connection listener.">SOPC_Endpoint_Config</a> in <a class="el" href="structSOPC__Server__Config.html#a079c00c95ad5157f12a3eaee8642b85a">SOPC_Server_Config::endpoints</a> and the <a class="el" href="index.html#methods">Method call manager configuration</a> shall be configured if CallMethod service shall be supported.</p>
<p>Finally for each endpoint of the server (<a class="el" href="structSOPC__Server__Config.html#a079c00c95ad5157f12a3eaee8642b85a">SOPC_Server_Config::endpoints</a>), <a class="el" href="sopc__toolkit__config_8h.html#a19ef9944ae3fadf5f3357999e9eabd94" title="Record the given endpoint configuration in given index (SOPC_Toolkit_Initialize required and prior to...">SOPC_ToolkitServer_AddEndpointConfig</a> shall be called to configure it in the server.</p>
<h2><a class="anchor" id="address"></a>
Configure initial address space</h2>
<p>Address space configuration shall be done to define the initial data present in the address space. This configuration shall be defined using <a href="http://opcfoundation.org/UA/2011/03/UANodeSet.xsd">OPC UA standard schema</a>. An example is provided for <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/samples/ClientServer/data/address_space/s2opc_nano.xml">a nano server</a> and <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/samples/ClientServer/data/address_space/s2opc.xml">a nano extended server</a>.</p>
<p>All the reciprocal references between nodes shall be present in it. The script <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/scripts/gen-reciprocal-refs-address-space.xslt">gen-reciprocal-refs-address-space.xslt</a> might be used to generate reciprocal references missing (XSLT 2.0 processor required).</p>
<p>Once the XML address space is defined, the C structure to be used for toolkit configuration shall be generated. It could be done using the Python C code generator prior to compilation or using the dynamic XML loader.</p>
<p>Use the XML dynamic loader <a class="el" href="sopc__uanodeset__loader_8h.html#a8fa51923b08a6e1067180893a7f38f51">SOPC_UANodeSet_Parse</a> to convert at runtime a UANodeSet XML file to expected C structure to be configured with <a class="el" href="sopc__toolkit__config_8h.html#a32f517bb42d598b4d233a0c9bb3a4019" title="Set the given Address Space for the current toolkit server (SOPC_Toolkit_Initialize required and prio...">SOPC_ToolkitServer_SetAddressSpaceConfig</a>.<br  />
 Or use the Python script <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/scripts/generate-s2opc-address-space.py">generate-s2opc-address-space.py</a> to convert a UANodeSet XML file into a C file that can be compiled in the binary, and retrieved with the embedded address space loader <a class="el" href="sopc__addspace__loader_8h.html#ab8ba1daa7fd5404a9df232e593e42b85">SOPC_Embedded_AddressSpace_Load</a>.</p>
<p>Finally call <a class="el" href="sopc__toolkit__config_8h.html#a32f517bb42d598b4d233a0c9bb3a4019" title="Set the given Address Space for the current toolkit server (SOPC_Toolkit_Initialize required and prio...">SOPC_ToolkitServer_SetAddressSpaceConfig</a> with the address space structure to configure the server address space content and set the client write notification callback with <a class="el" href="sopc__toolkit__config_8h.html#a424f17d1ba334f8cfe561e2c70a5fc78" title="Set the given Address Space modification notification callback for the current toolkit server (SOPC_T...">SOPC_ToolkitServer_SetAddressSpaceNotifCb</a> to receive notification on client write operation.</p>
<h2><a class="anchor" id="address2"></a>
Configure address space update</h2>
<p>Once the initial address space is configured, you might want to configure behavior on address space update from client or to configure how to update address space locally.</p>
<p>The server application will be notified of address space changes, it only needs to configure the associated callback using <a class="el" href="sopc__toolkit__config_8h.html#a424f17d1ba334f8cfe561e2c70a5fc78" title="Set the given Address Space modification notification callback for the current toolkit server (SOPC_T...">SOPC_ToolkitServer_SetAddressSpaceNotifCb</a> with the <a class="el" href="sopc__user__app__itf_8h.html#a39a48c765d6c21d20b1aa49e25673722" title="Toolkit address space notification events callback type.">SOPC_AddressSpaceNotif_Fct</a> application callback to manage received <a class="el" href="sopc__user__app__itf_8h.html#a106d0ab36a9516181eb5fce1ed9fea71a54fc1ebfe28619e61b9e465e4675bb12">AS_WRITE_EVENT</a> events from toolkit.</p>
<p>The server application is able to modify the address space on runtime using OPC UA services locally. It is allowed to treat OPC UA service requests (<a class="el" href="sopc__types_8h.html#aed9198a8cbdd05b6818034ecb4b3a3b1">OpcUa_ReadRequest</a>, <a class="el" href="sopc__types_8h.html#a065a536c54432f99645effc7f16e240a">OpcUa_WriteRequest</a>, <a class="el" href="sopc__types_8h.html#a9cab834d7c5fa7a948e5a5d9f7e016db">OpcUa_BrowseRequest</a> and discovery service requests) using <a class="el" href="sopc__toolkit__async__api_8h.html#ae8ef9b97182a275458b8e267c96df9b0" title="Request to execute locally the given service request on server and receive response.">SOPC_ToolkitServer_AsyncLocalServiceRequest</a>. Once the function is called, an asynchronous <a class="el" href="sopc__user__app__itf_8h.html#a887f1dd52095dbd128e4df7be970048fa6acb4dcb1407eba4269c8b8b4e7f2f7d">SE_LOCAL_SERVICE_RESPONSE</a> event will be received by the <a class="el" href="sopc__user__app__itf_8h.html#a20861cf43223f7b171bc951e9c751143" title="Toolkit communication events application callback type.">SOPC_ComEvent_Fct</a> application callback containing the response message (<a class="el" href="sopc__types_8h.html#a4c3d2189ef1613380cda420976b9c7e0">OpcUa_ReadResponse</a>, etc.).</p>
<h2><a class="anchor" id="users"></a>
User authentication and user authorization managers</h2>
<p>User authentication and user authorization managers shall be implemented for each endpoint (<a class="el" href="structSOPC__Endpoint__Config.html#a6d2533e37dfd779bb14d7741c11b37af">SOPC_Endpoint_Config::authenticationManager</a> and <a class="el" href="structSOPC__Endpoint__Config.html#a7ca71f10c90401c6ee1dbb0b83aeb3b5">SOPC_Endpoint_Config::authorizationManager</a>).</p>
<p>Default implementations accepting any user for authentication (<a class="el" href="sopc__user__manager_8h.html#ad2696a89a087be6528ed090b40073d8e" title="A helper implementation that always authentication positively a user.">SOPC_UserAuthentication_CreateManager_AllowAll</a>) and authorization (<a class="el" href="sopc__user__manager_8h.html#aaceef7e1abde20a2bf0c4bb73f1934e5" title="A helper implementation that always authorize an operation.">SOPC_UserAuthorization_CreateManager_AllowAll</a>) are provided for development use. Otherwise either application implements its own functions (<a class="el" href="sopc__user__manager_8h.html#a32a1e2c90bae6cd4661f939d3d29d999">SOPC_UserAuthentication_ValidateUserIdentity_Func</a> and <a class="el" href="sopc__user__manager_8h.html#a5efc15a1e12b7ec49d43c83dbe4960ce">SOPC_UserAuthorization_AuthorizeOperation_Func</a>) depending on its needs (LDAP, etc.) or a simple implementation based on XML user management configuration file loading is provided.</p>
<p>In the latter case use the parser for XML user management configuration file (<a href="https://gitlab.com/systerel/S2OPC/-/blob/master/schemas/s2opc_clientserver_users_config.xsd">XSD schema</a>, <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/samples/ClientServer/data/config/S2OPC_Users_Demo_Config.xml">XML example</a>) <a class="el" href="sopc__users__loader_8h.html#a7cfe427235964ce849c33f86fcf0d691">SOPC_UsersConfig_Parse</a> and set result in <a class="el" href="structSOPC__Endpoint__Config.html" title="Server configuration of a Endpoint connection listener.">SOPC_Endpoint_Config</a>.</p>
<dl class="section note"><dt>Note</dt><dd>The toolkit does not provide default implementation to encrypt/decrypt the user credentials which means a Secure Channel with SignAndEncrypt security mode and None user security policy shall be used.</dd></dl>
<h2><a class="anchor" id="methods"></a>
Method call manager configuration</h2>
<p>If the MethodCall service shall be supported, it is necessary to define a method call manager <a class="el" href="structSOPC__MethodCallManager.html" title="The SOPC_MethodCallManager object defines the common interface for the method manager.">SOPC_MethodCallManager</a>. A basic implementation is provided by <a class="el" href="sopc__call__method__manager_8h.html#a7ca328467713050b2c63df1a4b0e34ff" title="Provide a basic implementation of MethodCallManager. This implementation can be used with SOPC_Method...">SOPC_MethodCallManager_Create</a>, this manager provides the function <a class="el" href="sopc__call__method__manager_8h.html#af899d41ff414a8754c1e2033b7b9bc81" title="Associate a C function to a NodeId of a Method. This function should be used only with the basic impl...">SOPC_MethodCallManager_AddMethod</a> to define method implementation through <a class="el" href="sopc__call__method__manager_8h.html#a5faf85e8827efe6a7db6423308a64f56" title="Type of the function to call associated to a method.">SOPC_MethodCallFunc_Ptr</a> callback.</p>
<h1><a class="anchor" id="pubsub"></a>
PubSub API</h1>
<p>Examples of Pub or Sub test applications can be found here <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/tests/PubSub/validation_tests/pub_scheduler_test.c">publisher</a> and <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/tests/PubSub/validation_tests/sub_scheduler_conf_test.c">subscriber</a>, and a PubSub-Server sample is implemented <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/samples/PubSub_ClientServer/pubsub_server">here</a>.</p>
<p>Main interface is defined by <a class="el" href="sopc__pub__scheduler_8h.html">sopc_pub_scheduler.h</a> and <a class="el" href="sopc__sub__scheduler_8h.html">sopc_sub_scheduler.h</a>.</p>
<h2><a class="anchor" id="pubsub_config"></a>
Configuration API</h2>
<p>The PubSub configuration API is provided through <a class="el" href="sopc__pubsub__conf_8h.html">sopc_pubsub_conf.h</a> and uses the concepts of OPC UA PubSub specification Common Configuration Model (see §9.1 in OPC UA part 14 v1.04) to define the following elements configuration: PubSubConnection, ReaderGroup, DataSetReader, SecurityMode, SecurityKeyServices, FieldTarget, FieldMetaData, PublishedDataSet, WriterGroup, WriterDataSet, PublishedDataSet, PublishedDataSetSource, PublishedVariable.</p>
<p>The protocol to use is automatically deduced from the PubSubConnection address prefix (only UDP, Ethernet and MQTT supported for now). The configuration might be generated by parsing an XML configuration file, with <a href="https://gitlab.com/systerel/S2OPC/-/blob/master/schemas/s2opc_pubsub_config.xsd">XSD schema format</a>, using the function <a class="el" href="sopc__xml__loader_8h.html#a947c665aac95b0a80d620a88c8202600">SOPC_PubSubConfig_ParseXML</a> to dynamically parse XML file. Or statically using &lt;a href="<a href="https://gitlab.com/systerel/S2OPC/-/blob/master/scripts/generate-s2opc_pubsub-static-config.py">https://gitlab.com/systerel/S2OPC/-/blob/master/scripts/generate-s2opc_pubsub-static-config.py</a>&gt;generate-s2opc_pubsub-static-config.py script which generate a C file. SOPC_PubSubConfig_GetStatic function is generated and return <a class="el" href="sopc__pubsub__conf_8h.html#aca0e954e0cbc1d79a4bf605c8bbed7f9">SOPC_PubSubConfiguration</a> pointer.</p>
<h2><a class="anchor" id="pubsub_handlers"></a>
Configure data source/target handlers</h2>
<p>For a Publisher application, a data source handler shall be defined to retrieve the data from configured information in the PublishedDataSet. The handler shall be built using <a class="el" href="sopc__pub__source__variable_8h.html#a417babe5d01bf2a96e22949d2d52239f">SOPC_PubSourceVariableConfig_Create</a>, by providing a function with the signature <a class="el" href="sopc__pub__source__variable_8h.html#afa66e303229f48c9dfd284d5fa482717" title="The publisher calls this callback cyclically to get the values to publish.">SOPC_GetSourceVariables_Func</a>, and shall then be provided on Publisher start.</p>
<p>For a Subscriber application, a data target handler shall be defined to set the data from configured information in the DataSetReader. The handler shall be built using <a class="el" href="sopc__sub__target__variable_8h.html#a89bd1670be69f12c8ac872cd0a38bda9">SOPC_SubTargetVariableConfig_Create</a> by providing a function with the signature <a class="el" href="sopc__sub__target__variable_8h.html#a9b98b9e8d68fabe6d9a0b1947c459f9d" title="The subscriber scheduler calls this callback cyclically to pass the values received by the subscriber...">SOPC_SetTargetVariables_Func</a>, and shall then be provided on Subscriber start.</p>
<h2><a class="anchor" id="pubsub_sks"></a>
Configure local Key Bunch API</h2>
<p>For Publisher and Subscriber applications a key bunch is used to permit encrypted/signed communication. The PubSub local Key Bunch API is provided through <a class="el" href="sopc__pubsub__local__sks_8h.html">sopc_pubsub_local_sks.h</a> .key files are loaded using the function <a class="el" href="sopc__pubsub__local__sks_8h.html#a395ae009566fba211381d3a6b2c73532" title="Initialise the KeyBunch with keys file path.">SOPC_KeyBunch_init</a>.</p>
<dl class="section note"><dt>Note</dt><dd>A Security Key Services (SKS) is being developed. Key bunch act as a stub to permit encrypted/signed PubSub communication until SKS is finished.</dd></dl>
<h2><a class="anchor" id="pubsub_lifecycle"></a>
PubSub lifecycle</h2>
<p>The Publisher lifecycle is managed through the functions <a class="el" href="sopc__pub__scheduler_8h.html#acc446fa174e47bc6eb8922dd12db0b6c" title="Starts the Publisher scheduler using the PubSub configuration data and the source of data information...">SOPC_PubScheduler_Start</a> and <a class="el" href="sopc__pub__scheduler_8h.html#a17cb739a6982e4c7aea6bfd7dd9fd037">SOPC_PubScheduler_Stop</a>. And the Subscriber lifecycle is managed through the functions <a class="el" href="sopc__sub__scheduler_8h.html#a47310edf5c745f059b44639e65e1a3f2">SOPC_SubScheduler_Start</a> and <a class="el" href="sopc__sub__scheduler_8h.html#a33bca9f7e642d4069842c96d6bfa32ad">SOPC_SubScheduler_Stop</a>. The Subscriber state changes might be received by providing a handler with the signature <a class="el" href="sopc__sub__scheduler_8h.html#a3a29a2dce638eef54460a72b21eed577">SOPC_SubscriberStateChanged_Func</a>.</p>
<dl class="section note"><dt>Note</dt><dd>The PubSub library part is only supported for POSIX platform for the moment.</dd></dl>
<h1><a class="anchor" id="config_constants"></a>
OPC UA stack behavior configuration constants</h1>
<p>Two sets of constants are defined to configure the OPC UA stack behavior, one is defined for the OPC UA common encoding layer and another for the OPC UA Client/Server services layer. Those variables might be changed for specific needs at library compile time and are defined in respectively in <a class="el" href="sopc__common__constants_8h.html" title="Contains the configuration constants used by S2OPC common library. Those constants could be modified ...">sopc_common_constants.h</a> and <a class="el" href="sopc__toolkit__config__constants_8h.html" title="Contains the configuration constants used by the Tookit. Those constants could be modified for specif...">sopc_toolkit_config_constants.h</a>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jan 17 2023 17:32:14 for S2OPC OPCUA Toolkit by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
